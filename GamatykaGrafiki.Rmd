---
title: "Skrypty reprodukujące wykresy z rozdziału ,,Gramatyka języka wizualizacji historii''"
author: "Przemyslaw Biecek"
date: "22 December 2015"
output: 
  html_document:
    toc: TRUE
---

# Przygotowanie

```{r, warning=FALSE, message=FALSE}
library(ggplot2)
library(scales)
library(dplyr)
library(archivist)

# store everything in the archivist repo
setLocalRepo("arepo")

q3 <- function(x) {
  a <- quantile(x, c(0.25,0.5,0.75))
  names(a) <- c("ymin", "y", "ymax")
  a
}

print.ggplot <- function(x, ...) {
  hash <- saveToRepo(x)
  cat("Load: [`archivist::aread('pbiecek/Eseje/arepo/",hash,"')`](https://github.com/pbiecek/Eseje/raw/master/arepo/gallery/",hash,".rda)\n", sep="")
  ggplot2:::print.ggplot(x, ...)
}

```

# Dane

W tym skrypcie wykorzystujemy pakiet `SmarterPoland` i zbiory danych

```{r, warning=FALSE, message=FALSE}
library(SmarterPoland)
head(countries)
head(maturaExam)
```

# Warstwy

```{r, warning=FALSE, message=FALSE, fig.width=6, fig.height=6, results='asis'}
countriesMin <- countries %>% 
  group_by(continent) %>% 
  filter(birth.rate == min(birth.rate, na.rm=TRUE))
countriesMax <- countries %>% 
  group_by(continent) %>% 
  filter(birth.rate == max(birth.rate, na.rm=TRUE))
  
ggplot(countries, aes(x=continent, y=birth.rate, label=country)) +
  geom_violin(scale="area", fill="grey", color="white") + 
  stat_summary(fun.data = "q3", geom = "crossbar",
               colour = "red", width = 0.4) + 
  geom_jitter(position=position_jitter(width = .25, height = 0),
             shape=15) +
  geom_rug(sides = "l") + 
  geom_text(data=countriesMin, vjust=2, color="blue3") + 
  geom_text(data=countriesMax, vjust=-1, color="blue3") + 
  theme_bw() + xlab("") + theme(panel.grid.major.x = element_line(color="white"))

ggplot(countries, aes(x=birth.rate, y=death.rate)) +
  geom_density_2d(h=c(10,10), color="grey") +
  geom_point() + coord_fixed() +
  geom_abline(intercept=0,slope=1) + 
  geom_point(data=countries[132,], color="red", size=4) + 
  theme_bw() 

```

# Mapowania

```{r, warning=FALSE, message=FALSE, fig.width=6, fig.height=6, results='asis'}
ggplot(countries, aes(x=birth.rate, y=death.rate)) +
  geom_point() + coord_fixed() +
  theme_bw() 

ggplot(countries, aes(x=birth.rate, y=death.rate, 
                      color=continent, shape=continent)) +
  geom_point() + coord_fixed() +
  theme_bw() + theme(legend.position="top") 


countries$populationCat <- cut(countries$population, 
                               c(1, 10^3, 10^4, 10^5, 10^6, 10^7), 
                               labels = c("< 1M", "< 10M","< 100 M", "< 1 B", "> 1 B"), ordered_result = TRUE)

ggplot(countries, aes(x=birth.rate, y=death.rate, 
                      color=continent, shape=continent,
                      size=populationCat)) +
  geom_point() + coord_fixed() +
  theme_bw() + theme(legend.position="top") 

```

# Formy / Geometrie

## Punkty

```{r, warning=FALSE, message=FALSE, fig.width=6, fig.height=6, results='asis'}
# dotplot
ggplot(countries, aes(x = continent, y = birth.rate)) +
  geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 0.7) +
  theme_bw()

# dotplot
ggplot(countries, aes(x = birth.rate, y =death.rate)) +
  geom_point() +
  theme_bw()

# jitter
ggplot(countries, aes(x = continent, y =birth.rate)) +
  geom_jitter(position = position_jitter(width = .2)) +
  theme_bw()

# różne mapownia
ggplot() +
  geom_point(data=countries, aes(x = birth.rate, y =death.rate, shape=continent), size=4) +
  theme_bw() +
  scale_shape_manual(values=c("F","A","S","E","O")) +
  theme(legend.position=c(0.9,0.17))

ggplot() +
  geom_point(data=countries, aes(x = birth.rate, y =death.rate, color=continent), size=4, shape=19) +
  theme_bw() + scale_color_brewer(type = "qual", palette=6) +
  theme(legend.position=c(0.9,0.17))

ggplot() +
  geom_point(data=countries, aes(x = birth.rate, y =death.rate, size=population)) +
  scale_size_continuous(trans="sqrt", label=comma, limits=c(0,1500000)) +
  theme_bw() + theme(legend.position="none")

```

## Obszar

```{r, warning=FALSE, message=FALSE, fig.width=6, fig.height=6, results='asis'}

# density
ggplot(countries, aes(x = birth.rate, fill = continent)) +
  geom_density(alpha=0.5) +
  theme_bw() + theme(legend.position=c(0.85,0.85))

# vioplot
ggplot(countries, aes(x = continent, y = birth.rate, fill=continent)) +
  geom_violin() +
  theme_bw() + theme(legend.position="none")

# ribbon
ndf <- countries %>%
  group_by(continent) %>%
  summarise(birth.rate = weighted.mean(birth.rate, population, na.rm=TRUE),
            death.rate = weighted.mean(death.rate, population, na.rm=TRUE))

ggplot() + 
  geom_ribbon(data=ndf, aes(x=continent, ymax=birth.rate, y=birth.rate, ymin=0, group=1), fill="green3") +
  geom_ribbon(data=ndf, aes(x=continent, ymax=death.rate, y=death.rate, ymin=0, group=1), fill="red3") +
  theme_bw() + xlab("") + ylab("birth.rate / death.rate")

```

## Prostokąty

```{r, warning=FALSE, message=FALSE, fig.width=6, fig.height=6, results='asis'}


```

# Statystyki

```{r, warning=FALSE, message=FALSE, fig.width=6, fig.height=6, results='asis'}

```

# Modyfikatory położenia

```{r, warning=FALSE, message=FALSE, fig.width=6, fig.height=6, results='asis'}

```

# Układ współrzędnych

```{r, warning=FALSE, message=FALSE, fig.width=6, fig.height=6, results='asis'}

```

# Miary / podziałki / skale

```{r, warning=FALSE, message=FALSE, fig.width=6, fig.height=6, results='asis'}

```

# Panele / oblicza

```{r, warning=FALSE, message=FALSE, fig.width=6, fig.height=6, results='asis'}

```

# Dekoracje

```{r, warning=FALSE, message=FALSE, fig.width=6, fig.height=6, results='asis'}

```
